<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Dynamic Loader With Stable AdBlock Detection</title>

  <style>
    body { font-family: Arial; background: #f0f0f0; text-align: center; padding: 20px; }
    iframe { width: 100%; height: 80vh; border: none; display: none; }

    .loader {
      margin: 40px auto;
      width: 60px; height: 60px;
      border-radius: 50%;
      background: #3498db;
      animation: pulse 1s infinite ease-in-out;
    }
    @keyframes pulse {
      0% { transform: scale(0.8); opacity: 0.6; }
      50% { transform: scale(1); opacity: 1; }
      100% { transform: scale(0.8); opacity: 0.6; }
    }

    #adblock-warning {
      display: none;
      background: #c62828;
      color: #fff;
      padding: 20px;
      border-radius: 8px;
      font-size: 22px;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h2 id="status">Checking…</h2>
<div id="loader" class="loader"></div>
<div id="adblock-warning">⚠️ AdBlock Detected! Please disable and refresh.</div>
<iframe id="viewer"></iframe>

<script>
/* ----------------------------------------------------------
   LAYER 1 — Element bait (perfect accuracy)
---------------------------------------------------------- */
function baitElementCheck() {
  return new Promise(resolve => {
    const bait = document.createElement("div");
    bait.className = "adsbox ad-banner ad-container ad-slot";
    bait.style.position = "absolute";
    bait.style.left = "-9999px";
    document.body.appendChild(bait);

    setTimeout(() => {
      const blocked =
        bait.offsetHeight === 0 ||
        bait.offsetParent === null ||
        getComputedStyle(bait).display === "none";

      bait.remove();
      resolve(blocked);
    }, 100);
  });
}

/* ----------------------------------------------------------
   LAYER 2 — CSS bait check
---------------------------------------------------------- */
function cssBaitCheck() {
  return new Promise(resolve => {
    const bait = document.createElement("div");
    bait.className = "adsbox";
    bait.style.height = "20px";
    document.body.appendChild(bait);

    setTimeout(() => {
      const blocked = bait.offsetHeight === 0;
      bait.remove();
      resolve(blocked);
    }, 100);
  });
}

/* ----------------------------------------------------------
   LAYER 3 — Local fake ad script test (no CORS, NO false detect)
---------------------------------------------------------- */
function scriptBaitCheck() {
  return new Promise(resolve => {
    const script = document.createElement("script");
    script.src = "./ads.js";   // fake local ad script
    script.onload  = () => resolve(false); // loaded (no blocker)
    script.onerror = () => resolve(true);  // blocked (adblocker)
    document.body.appendChild(script);
  });
}

/* ----------------------------------------------------------
   MASTER DETECTOR
---------------------------------------------------------- */
async function detectAdBlock() {
  const checks = await Promise.all([
    baitElementCheck(),
    cssBaitCheck(),
    scriptBaitCheck()
  ]);

  return checks.includes(true);
}

/* ----------------------------------------------------------
   MAIN LOGIC
---------------------------------------------------------- */
detectAdBlock().then(isBlocked => {

  if (isBlocked) {
    document.getElementById("loader").style.display = "none";
    document.getElementById("status").innerText = "AdBlock Detected!";
    document.getElementById("adblock-warning").style.display = "block";
    return;
  }

  startLoader();
});

/* ----------------------------------------------------------
   LOAD URL FROM links.txt IF NO ADBLOCK
---------------------------------------------------------- */
function startLoader() {
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  if (!id) {
    document.getElementById("status").innerText = "No ID in URL.";
    return;
  }

  fetch("links.txt")
    .then(r => r.text())
    .then(text => {
      const lines = text.split("\n");
      let url = null;

      lines.forEach(line => {
        if (line.startsWith(id + "=")) url = line.split("=")[1].trim();
      });

      if (!url) {
        document.getElementById("status").innerText = "ID not found.";
        document.getElementById("loader").style.display = "none";
        return;
      }

      const iframe = document.getElementById("viewer");

      iframe.onload = () => {
        document.getElementById("loader").style.display = "none";
        iframe.style.display = "block";
        document.getElementById("status").innerText = "Loaded:";
      };

      iframe.src = url;
    });
}
</script>

</body>
</html>
