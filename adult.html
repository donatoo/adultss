<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Dynamic Loader With Ultra AdBlock Detection</title>

  <style>
    body { font-family: Arial; background: #f0f0f0; text-align: center; padding: 20px; }
    iframe { width: 100%; height: 80vh; border: none; display: none; }

    .loader {
      margin: 40px auto;
      width: 60px; height: 60px;
      border-radius: 50%;
      background: #3498db;
      animation: pulse 1s infinite ease-in-out;
    }
    @keyframes pulse {
      0% { transform: scale(0.8); opacity: 0.6; }
      50% { transform: scale(1); opacity: 1; }
      100% { transform: scale(0.8); opacity: 0.6; }
    }

    #adblock-warning {
      display: none;
      background: #c62828;
      color: #fff;
      padding: 20px;
      border-radius: 8px;
      font-size: 22px;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h2 id="status">Checking…</h2>
<div id="loader" class="loader"></div>
<div id="adblock-warning">⚠️ AdBlock Detected! Please disable and refresh.</div>
<iframe id="viewer"></iframe>

<script>
/* ------------------------------------------------------------------
   LAYER 1 — Invisible bait element check
------------------------------------------------------------------ */
function baitElementCheck() {
  return new Promise(resolve => {
    const bait = document.createElement("div");
    bait.className = "ad adsbox ad-banner ad-container ad-slot";
    bait.style.position = "absolute";
    bait.style.left = "-9999px";
    document.body.appendChild(bait);

    setTimeout(() => {
      const blocked =
        bait.offsetHeight === 0 ||
        bait.offsetParent === null ||
        getComputedStyle(bait).display === "none";

      bait.remove();
      resolve(blocked);
    }, 150);
  });
}

/* ------------------------------------------------------------------
   LAYER 2 — REAL ad script test
------------------------------------------------------------------ */
// This URL is ALWAYS blocked by AdBlock:
const REAL_AD_SCRIPT = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js";

function fakeScriptTest() {
  return new Promise(resolve => {
    const script = document.createElement("script");
    script.src = REAL_AD_SCRIPT;
    script.onerror = () => resolve(true);   // Blocked
    script.onload  = () => resolve(false);  // Allowed (rare)
    document.body.appendChild(script);
  });
}

/* ------------------------------------------------------------------
   LAYER 3 — REAL ad network fetch test
------------------------------------------------------------------ */
const REAL_AD_URL = "https://securepubads.g.doubleclick.net/tag/js/gpt.js";

function networkTrapTest() {
  return fetch(REAL_AD_URL, { method: "HEAD", mode: "no-cors" })
    .then(() => false)
    .catch(() => true);  // Blocked
}

/* ------------------------------------------------------------------
   LAYER 4 — CSS rule inspection
------------------------------------------------------------------ */
function cssRuleTest() {
  return new Promise(resolve => {
    let test = document.createElement("div");
    test.innerHTML = "&nbsp;";
    test.className = "adsbox";
    document.body.appendChild(test);

    setTimeout(() => {
      const blocked = test.offsetHeight == 0;
      test.remove();
      resolve(blocked);
    }, 100);
  });
}

/* ------------------------------------------------------------------
   LAYER 5 — REAL ad iframe test
------------------------------------------------------------------ */
const REAL_AD_IFRAME = "https://googleads.g.doubleclick.net/pagead/html/r20190131/r20190131/zrt_lookup.html";

function iframeTrapTest() {
  return new Promise(resolve => {
    let frame = document.createElement("iframe");
    frame.src = REAL_AD_IFRAME;
    frame.style.width = "1px";
    frame.style.height = "1px";
    frame.style.position = "absolute";
    frame.style.left = "-9999px";

    frame.onload = () => resolve(false); // Loaded (not blocked)
    frame.onerror = () => resolve(true); // Blocked

    document.body.appendChild(frame);
  });
}

/* ------------------------------------------------------------------
   RUN ALL TESTS + DECISION
------------------------------------------------------------------ */
async function detectAdBlock() {
  const results = await Promise.all([
    baitElementCheck(),
    fakeScriptTest(),
    networkTrapTest(),
    cssRuleTest(),
    iframeTrapTest()
  ]);

  const triggers = results.filter(x => x === true).length;

  // Strict mode: ANY detection = blocked
  return triggers > 0;
}

/* ------------------------------------------------------------------
   MAIN START
------------------------------------------------------------------ */
detectAdBlock().then(isBlocked => {

  if (isBlocked) {
    document.getElementById("loader").style.display = "none";
    document.getElementById("status").innerText = "AdBlock Detected!";
    document.getElementById("adblock-warning").style.display = "block";
    return; // STOP EVERYTHING
  }

  startLoader();
});

/* ------------------------------------------------------------------
   Normal content loading
------------------------------------------------------------------ */
function startLoader() {
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  if (!id) {
    document.getElementById("status").innerText = "No ID in URL.";
    return;
  }

  fetch("links.txt")
    .then(r => r.text())
    .then(text => {
      const lines = text.split("\n");
      let url = null;

      lines.forEach(line => {
        if (line.startsWith(id + "=")) url = line.split("=")[1].trim();
      });

      if (!url) {
        document.getElementById("status").innerText = "ID not found.";
        document.getElementById("loader").style.display = "none";
        return;
      }

      const iframe = document.getElementById("viewer");

      iframe.onload = () => {
        document.getElementById("loader").style.display = "none";
        iframe.style.display = "block";
        document.getElementById("status").innerText = "Loaded:";
      };

      iframe.src = url;
    });
}
</script>

</body>
</html>
