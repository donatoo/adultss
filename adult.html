<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Video Loader with Accurate Adblock Detection</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #111;
    color: white;
    margin: 0;
    padding: 0;
}

#loader {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-size: 25px;
}

#message {
    text-align: center;
    padding: 20px;
    display: none;
    color: red;
    font-size: 22px;
}

iframe {
    width: 100%;
    height: 100vh;
    border: none;
    display: none;
}
</style>
</head>
<body>

<div id="loader">‚è≥ Loading...</div>
<div id="message"></div>

<iframe id="video"></iframe>

<script>
// ------------------------------
// REAL ACCURATE ADBLOCK DETECTOR
// ------------------------------

async function detectAdblock() {
    let bait = document.createElement("div");
    bait.className = "ad-banner ad adsbox advertisement";
    bait.style.height = "1px";
    bait.style.position = "absolute";
    bait.style.top = "-1000px";
    document.body.appendChild(bait);

    let baitBlocked = false;

    // Test 1: CSS hiding
    if (getComputedStyle(bait).display === "none" || bait.offsetHeight === 0) {
        baitBlocked = true;
    }

    // Test 2: Script-based blocking
    let scriptBlocked = false;
    try {
        await fetch("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js", {
            method: "HEAD",
            mode: "no-cors"
        });
    } catch (e) {
        scriptBlocked = true;
    }

    // Test 3: Real ad request (this is an actual ad server URL)
    let realAdBlocked = false;
    try {
        await fetch("https://securepubads.g.doubleclick.net/tag/js/gpt.js", {
            method: "HEAD",
            mode: "no-cors"
        });
    } catch (e) {
        realAdBlocked = true;
    }

    document.body.removeChild(bait);

    // Must fail ALL 3 tests before we declare true blocking
    return (baitBlocked && scriptBlocked && realAdBlocked);
}

// ----------------------------------
// LOAD VIDEO ONLY IF NO AD BLOCKING
// ----------------------------------

async function init() {
    let detected = await detectAdblock();

    if (detected) {
        document.getElementById("loader").style.display = "none";
        let msg = document.getElementById("message");
        msg.style.display = "block";
        msg.innerHTML = "üö´ Please disable AdBlock to continue.<br>This video cannot load while AdBlock is enabled.";
        return;
    }

    // If no adblock detected, continue loading the video
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    if (!id) {
        document.getElementById("loader").textContent = "Error: No ID in URL";
        return;
    }

    // Load the .txt file
    fetch(`videos/${id}.txt`)
        .then(r => r.text())
        .then(url => {
            document.getElementById("loader").style.display = "none";
            let iframe = document.getElementById("video");
            iframe.src = url.trim();
            iframe.style.display = "block";
        })
        .catch(() => {
            document.getElementById("loader").textContent = "Video not found.";
        });
}

init();
</script>

</body>
</html>
