// ==UserScript==
// @name         Vid Player â€” Custom Subtitle DIV Renderer
// @namespace    http://tampermonkey.net/
// @version      2025-08-21
// @description  Clean player UI + custom subtitle container with full styling & timing control
// @author       You
// @match        *://*/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=chatgpt.com
// @grant        none
// ==/UserScript==



(function() {
    'use strict';

    // --- Block popup attempts ---
    const origOpen = window.open;
    let lastClick = 0;
    document.addEventListener("click", () => lastClick = Date.now(), true);

    window.open = function(url, ...args) {
        const userGesture = Date.now() - lastClick < 1500;
        const badDomains = [
            "adsco.re", "doubleclick.net", "googlesyndication.com",
            "popads", "propellerads", "onclickads", "outbrain.com", "taboola.com"
        ];
        if (!userGesture || (url && badDomains.some(d => url.includes(d)))) {
            console.warn("ðŸš« Blocked popup:", url);
            return { focus: () => {}, close: () => {} };
        }
        return origOpen.apply(window, [url, ...args]);
    };

    // --- Block location hijacks ---
    ["assign","replace","reload"].forEach(fn => {
        window.location[fn] = () => console.warn(`ðŸš« Blocked location.${fn}`);
    });

    // --- Kill ad overlays ---
    const isAdOverlay = (el) => {
        try {
            const style = getComputedStyle(el);
            const z = parseInt(style.zIndex, 10);
            const coversScreen =
                el.offsetWidth >= window.innerWidth * 0.5 &&
                el.offsetHeight >= window.innerHeight * 0.5;
            return (
                (style.position === "fixed" || style.position === "absolute") &&
                (!isNaN(z) && z >= 20) &&
                coversScreen
            );
        } catch {
            return false;
        }
    };

    const isAdIframe = (iframe) => {
        const src = iframe.getAttribute("src") || "";
        return [
            "adsco.re", "doubleclick.net", "googlesyndication.com",
            "adnxs.com", "taboola.com", "popcash.net", "outbrain.com"
        ].some(d => src.includes(d));
    };

    const scanAndRemove = () => {
        document.querySelectorAll("div, iframe").forEach(el => {
            if (el.tagName === "DIV" && isAdOverlay(el)) {
                console.warn("ðŸš« Removed overlay:", el);
                el.remove();
            } else if (el.tagName === "IFRAME" && isAdIframe(el)) {
                console.warn("ðŸš« Removed ad iframe:", el.src);
                el.remove();
            }
        });
    };

    // Initial cleanup
    window.addEventListener("load", scanAndRemove);

    // Observe dynamically added elements
    const observer = new MutationObserver(() => scanAndRemove());
    observer.observe(document.body, { childList: true, subtree: true });

})();
